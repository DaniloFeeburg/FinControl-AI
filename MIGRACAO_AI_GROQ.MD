# MigraÃ§Ã£o de IA: Google Gemini â†’ Groq

## âœ… Status: IMPLEMENTADO

A migraÃ§Ã£o foi implementada com sucesso. O sistema agora usa **Groq como provedor principal** (gratuito) com **fallback para Gemini**.

---

## ğŸ“‹ Resumo das AlteraÃ§Ãµes

### Arquivos Criados

| Arquivo              | DescriÃ§Ã£o                          |
| -------------------- | ---------------------------------- |
| `backend/ai_groq.py` | Novo serviÃ§o de IA usando Groq API |

### Arquivos Modificados

| Arquivo                    | AlteraÃ§Ã£o                                       |
| -------------------------- | ----------------------------------------------- |
| `backend/main.py`          | Endpoint `/ai/analysis` agora usa Groq primeiro |
| `backend/ofx_service.py`   | CategorizaÃ§Ã£o usa Groq como provedor principal  |
| `backend/requirements.txt` | Adicionado `httpx==0.27.0`                      |
| `cloudbuild.yaml`          | Adicionado secret `GROQ_API_KEY`                |
| `.env.example`             | Adicionada configuraÃ§Ã£o `GROQ_API_KEY`          |
| `env.example`              | Adicionada configuraÃ§Ã£o `GROQ_API_KEY`          |

---

## ğŸš€ Como Ativar

### 1. Obter Chave da API Groq (GRATUITO)

1. Acesse: https://console.groq.com/keys
2. Crie uma conta (gratuita)
3. Gere uma nova API Key
4. A chave comeÃ§a com `gsk_`

### 2. Configurar no Google Cloud (ProduÃ§Ã£o)

```bash
# Criar o secret no Google Cloud
echo -n "gsk_SUA_CHAVE_AQUI" | gcloud secrets create GROQ_API_KEY --data-file=-

# OU atualizar se jÃ¡ existir
echo -n "gsk_SUA_CHAVE_AQUI" | gcloud secrets versions add GROQ_API_KEY --data-file=-
```

### 3. Fazer Deploy

```bash
git add .
git commit -m "feat: migraÃ§Ã£o de IA para Groq (gratuito)"
git push origin main
```

---

## ğŸ“Š Comparativo: Groq vs Gemini

| CaracterÃ­stica | Groq (Novo)           | Gemini (Anterior)     |
| -------------- | --------------------- | --------------------- |
| **PreÃ§o**      | âœ… GRATUITO           | âš ï¸ Limite muito baixo |
| **Limite**     | 30 req/min, 14.4k/dia | 15 req/min (free)     |
| **Velocidade** | âš¡ Muito rÃ¡pido       | Moderado              |
| **Modelo**     | LLaMA 3.3 70B         | Gemini Pro            |
| **Qualidade**  | Excelente             | Excelente             |

---

## ğŸ”§ Arquitetura Implementada

```
RequisiÃ§Ã£o de IA
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GROQ_API_KEY    â”‚
â”‚ configurada?    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Sim     â”‚ NÃ£o
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Groq  â”‚  â”‚ GEMINI_API_KEY â”‚
â”‚ API   â”‚  â”‚ configurada?   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚
    â”‚         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚ Sim     â”‚ NÃ£o
    â”‚         â–¼         â–¼
    â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
    â”‚     â”‚Gemini â”‚  â”‚ Erro  â”‚
    â”‚     â”‚ API   â”‚  â”‚ 503   â”‚
    â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Resposta IA   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Testando Localmente

```bash
# Configurar variÃ¡vel de ambiente
set GROQ_API_KEY=gsk_sua_chave_aqui

# Rodar backend
cd backend
uvicorn main:app --reload

# Testar endpoint de anÃ¡lise
curl -X POST http://localhost:8000/ai/analysis \
  -H "Authorization: Bearer SEU_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"balance": 5000, "monthly_income": 8000, "monthly_expenses": 6000, "reserves_total": 10000}'
```

---

## âš ï¸ Notas Importantes

1. **Fallback automÃ¡tico**: Se Groq falhar, o sistema tenta Gemini automaticamente
2. **Retry com backoff**: Implementado para lidar com rate limits
3. **Compatibilidade**: CÃ³digo antigo continua funcionando com Gemini
4. **Logs**: Prefixo `[GROQ]` ou `[IA-Gemini]` nos logs para identificar provedor

---

## ğŸ“ CÃ³digo Original (ReferÃªncia)

Os cÃ³digos originais propostos estÃ£o abaixo para referÃªncia. A implementaÃ§Ã£o final foi ajustada para:

- Corrigir divisÃ£o por 100 (valores jÃ¡ eram em reais)
- Adicionar retry com backoff exponencial
- Manter compatibilidade com cÃ³digo existente
- Implementar fallback automÃ¡tico para Gemini

<details>
<summary>CÃ³digo original proposto (clique para expandir)</summary>

```python
# ai_groq.py (original)
# ... cÃ³digo original aqui ...
```

</details>
